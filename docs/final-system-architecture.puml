@startuml SparkBoard Final System Architecture

' ä½¿ç”¨ PlantUML å…§ç½®å…ƒç´ ï¼ˆä¸ä¾è³´å¤–éƒ¨åœ–æ¨™åº«ï¼Œæ›´ç©©å®šï¼‰
skinparam linetype ortho
skinparam rectangle {
    BackgroundColor<<sync>> #E8F5E9
    BorderColor<<sync>> #4CAF50
    BackgroundColor<<async>> #FFF3E0
    BorderColor<<async>> #FF9800
    BackgroundColor<<taught>> #E3F2FD
    BorderColor<<taught>> #2196F3
    BackgroundColor<<default>> #F5F5F5
    BorderColor<<default>> #333333
}

title SparkBoard æœ€çµ‚ç³»çµ±æ¶æ§‹åœ– (Final System Architecture)\nç„¡ä¼ºæœå™¨ä»»å‹™èˆ‡å…¬å‘Šç®¡ç†å¹³å°

actor "ä½¿ç”¨è€…\nUser" as user

rectangle "å‰ç«¯å±¤ Frontend Layer" <<taught>> {
    card "â˜ï¸ CloudFront\nCDN Distribution" as cf
    card "ğŸ’¾ S3 Bucket\nStatic Website\nReact + Vite" as s3web
}

rectangle "èªè­‰å±¤ Authentication Layer" <<taught>> {
    card "ğŸ”‘ Cognito\nUser Pool\nJWT Auth" as cognito
}

rectangle "API å±¤ API Layer" <<taught>> {
    card "ğŸŒ API Gateway\nREST API\nCognito Authorizer" as apigw
}

rectangle "åŒæ­¥è¨ˆç®—å±¤ Synchronous Compute" <<sync>> <<taught>> {
    card "âš¡ Items Lambda\nCRUD Operations\nèª²å ‚æ•™é" as lambda_items
    card "âš¡ Auth Lambda\nUser Profile\nèª²å ‚æ•™é" as lambda_auth
    card "âš¡ Uploads Lambda\nPresigned URLs\nèª²å ‚æ•™é" as lambda_uploads
    card "âš¡ Users Lambda\nUser Mgmt (Admin)" as lambda_users
    card "âš¡ Health Lambda\nHealth Check" as lambda_health
    card "âš¡ Monitoring Lambda\nMetrics/Traces" as lambda_monitoring
}

rectangle "éåŒæ­¥è¨ˆç®—å±¤ Asynchronous Compute" <<async>> {
    card "âš¡ Notification Handler\nEmail Sending\nèª²å ‚æ•™é" as lambda_notify
    card "âš¡ Auto-Archive Lambda\nScheduled Task" as lambda_archive
    card "âš¡ PostConfirm Trigger\nAuto Group Add" as lambda_postconfirm
}

rectangle "æ•¸æ“šå±¤ Data Layer" <<taught>> {
    card "ğŸ“Š DynamoDB\nSparkTable\nSingle Table Design\n+ GSI1, GSI2\nèª²å ‚æ•™é" as ddb
    card "ğŸ’¾ S3 Bucket\nFile Storage\nUploads" as s3files
}

rectangle "è¨Šæ¯å±¤ Messaging Layer" <<async>> <<taught>> {
    card "ğŸ“¨ SQS Queue\nNotification Queue\n+ DLQ\nèª²å ‚æ•™é" as sqs
    card "ğŸ“§ SNS Topic\nEmail Service\nèª²å ‚æ•™é" as sns
}

rectangle "è‡ªå‹•åŒ–å±¤ Automation Layer" <<async>> {
    card "â° EventBridge\nCron Schedule\n(every 1 min)" as eb
}

rectangle "ç›£æ§å±¤ Observability Layer" {
    card "ğŸ“ˆ CloudWatch\nLogs + Metrics\nDashboard + Alarms" as cw
    card "ğŸ” X-Ray\nDistributed Tracing" as xray
}

' User flows
user -down-> cf : HTTPS
cf -down-> s3web : Fetch\nStatic Files
cf -down-> user : Cached\nContent

user -down-> apigw : "REST API Calls\n(åŒæ­¥ Sync)"
apigw -right-> cognito : Verify JWT\nToken
cognito -left-> apigw : Valid/Invalid

' Synchronous API flows (èª²å ‚æ•™é)
apigw -down-> lambda_items : "GET/POST/PATCH/DELETE /items\n(åŒæ­¥ Sync)"
apigw -down-> lambda_auth : "GET/PATCH /auth/me\n(åŒæ­¥ Sync)"
apigw -down-> lambda_uploads : "POST /uploads/presign\n(åŒæ­¥ Sync)"
apigw -down-> lambda_users : "GET/POST /users/* (Admin)\n(åŒæ­¥ Sync)"
apigw -down-> lambda_health : "GET /health\n(åŒæ­¥ Sync)"
apigw -down-> lambda_monitoring : "GET /monitoring/*\n(åŒæ­¥ Sync)"

' Lambda to DynamoDB (åŒæ­¥ èª²å ‚æ•™é)
lambda_items -down-> ddb : "PutItem/GetItem\nQuery/UpdateItem\n(åŒæ­¥ Sync)"
lambda_auth -down-> ddb : "Query Profile\n(åŒæ­¥ Sync)"
lambda_users -down-> ddb : "Scan Users\n(åŒæ­¥ Sync)"
lambda_archive -down-> ddb : "Query + Update\n(åŒæ­¥ Sync)"

' Lambda to S3
lambda_uploads -down-> s3files : "Generate\nPresigned URL"

' Asynchronous notification flow (èª²å ‚æ•™é)
lambda_items -down-> sqs : "Send Message\n(éåŒæ­¥ Async)\nèª²å ‚æ•™é"
sqs -down-> lambda_notify : "Trigger on\nMessage\n(éåŒæ­¥ Async)"
lambda_notify -down-> sns : "Publish Email\n(éåŒæ­¥ Async)"
lambda_notify -down-> ddb : "Query User\nData"
sns -up-> user : Email\nNotification

' EventBridge auto-archive (éåŒæ­¥)
eb -down-> lambda_archive : "Cron Trigger\nevery 1 min\n(éåŒæ­¥ Async)"

' Cognito trigger (éåŒæ­¥)
cognito -down-> lambda_postconfirm : "Post-Confirmation\nTrigger\n(éåŒæ­¥ Async)"

' Monitoring (èª²å ‚æ•™é)
lambda_items -up-> cw : "Logs + Metrics\nèª²å ‚æ•™é"
lambda_notify -up-> cw : "Logs + Metrics\nèª²å ‚æ•™é"
lambda_archive -up-> cw : "Logs + Metrics"
apigw -up-> xray : "Traces\nèª²å ‚æ•™é"
lambda_items -up-> xray : "Traces"

note right of lambda_items
  **æ ¸å¿ƒ Lambda å‡½æ•¸**
  â€¢ Items: ä»»å‹™/å…¬å‘Š CRUD
  â€¢ Auth: ç”¨æˆ¶è³‡æ–™ç®¡ç†
  â€¢ Uploads: S3 æª”æ¡ˆä¸Šå‚³
  â€¢ Users: ç®¡ç†å“¡åŠŸèƒ½
  â€¢ Health: å¥åº·æª¢æŸ¥
  â€¢ Monitoring: ç›£æ§å„€è¡¨æ¿
  
  **All synchronous (åŒæ­¥)**
end note

note right of lambda_notify
  **éåŒæ­¥è™•ç†**
  â€¢ SQS è¨Šæ¯ä½‡åˆ—
  â€¢ æœ€å¤šé‡è©¦ 3 æ¬¡
  â€¢ DLQ è™•ç†å¤±æ•—è¨Šæ¯
  â€¢ SNS ç™¼é€éƒµä»¶é€šçŸ¥
  
  **èª²å ‚æ•™éçš„æœå‹™**
end note

note right of ddb
  **Single Table Design**
  â€¢ PK: ITEM#{id} / USER#{id}
  â€¢ SK: METADATA / PROFILE
  â€¢ GSI1: userId + createdAt
  â€¢ GSI2: ITEM#ALL + createdAt
  
  **èª²å ‚æ•™é**
end note

note bottom of eb
  **å®šæ™‚ä»»å‹™**
  â€¢ æ¯åˆ†é˜è§¸ç™¼
  â€¢ è‡ªå‹•å°å­˜å·²å®Œæˆä»»å‹™
  â€¢ EventBridge + Lambda
end note

legend right
  |<#E8F5E9> åŒæ­¥è™•ç† (Synchronous) |
  |<#FFF3E0> éåŒæ­¥è™•ç† (Asynchronous) |
  |<#E3F2FD> èª²å ‚æ•™éçš„æœå‹™ (Taught in Class) |
endlegend

@enduml
